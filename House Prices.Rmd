---
title: 'R Quiz 3.2: House Prices'
author: "Olena Skalianska"
output:
  slidy_presentation: default
  beamer_presentation: default
  ioslides_presentation: default
---

## Quiz Assignment (30 minutes)

- You can work in groups but each student must submit an **individual** solution

- This assignment is individual because each student should practice Power BI, Tableau and R in order **to pass the exam**

- The idea of this quiz is to go over the same R plots for House prices with small modification of them to learn what each setting means

- You will just copy-paste pieces from the original code and change the code following the instructions

- Save this .rmd file as "YourLastName_R_Quiz_HousePrices.rmd" where you put your last name

- After you are done *Knit to HTML (Slidy)* the file and upload both .rmd and .html files to Dropbox: https://www.dropbox.com/request/sMwAYduBqszjnBmfUzHU 
 
- Copy and paste the chunk below to add your R code to slides
```{r, message=FALSE, results="hide"}
# Load the libraries that you will use etc
options(repos="http://cran.us.r-project.org") # May need this line to avoid errors
loadmanylibs <- c('ggplot2','corrplot','gridExtra') 
install.packages(loadmanylibs) #This line will install ALL (!) packages at once
lapply(loadmanylibs, require, character.only = TRUE) 
```

- Please do not modify slide names and order and do not add new slides so that I can properly grade this quiz

## Load libraries and Data

- Let's load libraries and data (to avoid confusion *clear* objects from the workspace)

```{r}
# Set working directory where you keep the dataset 
setwd("/Users/olena.skalianska/Desktop/KSE-Homework/Business Intelligence and Data Visualizations/Day 3 R") 
all <- read.csv("train.csv")
dim(all)
str(all[,c(1:10, 81)]) #display first 10 variables and the response variable
all$Id <- NULL #remove IDs

```

## Prepare Data

- Please do not copy and paste the code from your teammates (but you may discuss the code in team)

- **IMPORTANT:** It is usually a good idea to have slightly different datasets - please write your surnames in alphabetical order to determine the order
 
- If you are the *first* in the list use R code to keep only houses with less than 3 bedrooms: all<-all[all$BedroomAbvGr < 3,]

- If you are the *second* in the list use R code to keep only houses with exactly 3 bedrooms: all<-all[all$BedroomAbvGr == 3,]

- If you are the *third* in the list use R code to keep only houses with more than 3 bedrooms: all<-all[all$BedroomAbvGr > 3,]

```{r}
all<-all[all$BedroomAbvGr < 3,]
```

## Advanced histogram
- Plot a histogram from slide "More advanced histogram" for houses cheaper than 400000 using any other color instead of "blue"
```{r}
all$group = ifelse(all$SalePrice < 400001, "0-400000", ifelse(all$SalePrice < 500001, "400000+", "500000+"))
ggplot(data=all[!is.na(all$SalePrice), ], aes(x=SalePrice, fill = group)) +
        geom_histogram(binwidth = 10000) +
        scale_x_continuous(breaks= seq(0, 800000, by=100000)) +
        scale_fill_manual(values = c("0-400000" = "orange",
                                 "400000+" = "blue",
                                 "500000+" = "dark blue"))
```

## Correlation plot by strength of correlations
- Re-run code on slide "Plot correlations sorted by strength of correlation" for **positive** correlations only using ellipse for lower triangular correlation matrix. *Hint: type in RStudio console ?corrplot.mixed in order to open the Help file and scroll down for examples.*
```{r}
numericVars <- which(sapply(all, is.numeric)) #index vector numeric variables
numericVarNames <- names(numericVars) #saving names vector for use later on
cat('There are', length(numericVars), 'numeric variables')
all_numVar <- all[, numericVars]
cor_numVar <- cor(all_numVar, use="pairwise.complete.obs") #correlations of all numeric variables
# Sort on decreasing correlations with SalePrice
cor_sorted <- as.matrix(sort(cor_numVar[,'SalePrice'], decreasing = TRUE))
# Select only high corelations
CorHigh <- names(which(apply(cor_sorted, 1, function(x) abs(x)>0.5)))
cor_numVar <- cor_numVar[CorHigh, CorHigh]

corrplot.mixed(cor_numVar, lower="ellipse", upper = "circle", tl.col="black", tl.pos = "lt")
```

## Box plot of Sale price by overall quality
- Plot a modified boxplot for houses more expensive than 500000 using any other color instead of "blue"
```{r}
datanew <- all[all$SalePrice > 500000,]

ggplot(data=datanew[!is.na(datanew$SalePrice),], aes(x=factor(OverallQual), y=SalePrice))+
        geom_boxplot(colour = 'orange') + labs(x='Overall Quality') +
        scale_y_continuous(breaks= seq(0, 800000, by=100000))
```

## Sale price and number of houses sold by neighborhood 
- Plot a modified graph n1 (but not n2) without geom_label and with any other but red color of geom_hline
```{r}
n1 <- ggplot(all[!is.na(all$SalePrice),], aes(x=Neighborhood, y=SalePrice)) +
        geom_bar(stat='summary', fun.y = "median", fill='blue') +
        theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
        scale_y_continuous(breaks= seq(0, 800000, by=50000)) +
        geom_hline(yintercept=163000, linetype="dashed", color = "red") #dashed line is median SalePrice
## Warning: Ignoring unknown parameters: fun.y
```
```{r}
grid.arrange(n1) #Need package gridExtra
```

## Sale price by roof style
- Plot a modified graph tb2 (but not tb1) from slide "Sale price by the number of baths" by replacing the total number of bath by RoofStyle
```{r}
#all$RoofStyle <- all$FullBath + (all$HalfBath*0.5) + all$BsmtFullBath + (all$BsmtHalfBath*0.5)

tb2 <- ggplot(data=all, aes(x=as.factor(RoofStyle))) +
        geom_histogram(stat='count')

## Warning: Ignoring unknown parameters: binwidth, bins, pad
```
```{r}
grid.arrange(tb2)
```

## Sale price by year remodelled
- Plot a modified graph from slide "Sale price by year built" with year built by year remodelled (YearRemodAdd) and without scale_y_continuous
```{r}
ggplot(data=all[!is.na(all$SalePrice),], aes(x=YearRemodAdd, y=SalePrice))+
        geom_point(col='blue') + geom_smooth(method = "lm", se=FALSE, color="black", aes(group=1)) 
```



